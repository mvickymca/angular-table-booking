<div class="dashboard-container">
  <h1 class="dashboard-title">Restaurant Table Booking Dashboard</h1>
  
  <!-- Loading indicator -->
  <div *ngIf="loading" class="loading-spinner">
    <div class="spinner"></div>
    <p>Loading data from API...</p>
  </div>

  <!-- Error message -->
  <div *ngIf="error" class="error-message">
    <p>{{ error }}</p>
    <button (click)="loadAllData()" class="btn btn-primary">Retry</button>
  </div>

  <!-- Main content -->
  <div *ngIf="!loading">
    <!-- Navigation tabs -->
    <div class="tab-navigation">
      <button 
        [class.active]="activeTab === 'tables'" 
        (click)="activeTab = 'tables'"
        class="tab-button">
        Tables ({{ tables.length }})
      </button>
      <button 
        [class.active]="activeTab === 'bookings'" 
        (click)="activeTab = 'bookings'"
        class="tab-button">
        Bookings ({{ bookings.length }})
      </button>
      <button 
        [class.active]="activeTab === 'statistics'" 
        (click)="activeTab = 'statistics'"
        class="tab-button">
        Statistics
      </button>
    </div>

    <!-- Tables Tab -->
    <div *ngIf="activeTab === 'tables'" class="tab-content">
      <div class="section-header">
        <h2>Restaurant Tables</h2>
        <div class="action-buttons">
          <button (click)="showAvailableTables()" class="btn btn-success">Show Available</button>
          <button (click)="loadAllData()" class="btn btn-primary">Refresh</button>
          <button (click)="resetFilters()" class="btn btn-secondary">Reset Filters</button>
        </div>
      </div>

      <!-- Table Filters -->
      <div class="filters-section">
        <div class="filter-group">
          <label for="minCapacity">Min Capacity:</label>
          <input 
            id="minCapacity"
            type="number" 
            [(ngModel)]="minCapacity" 
            (ngModelChange)="filterTablesByCapacity()"
            min="1" 
            class="form-control">
        </div>
        <div class="filter-group">
          <label for="locationFilter">Location:</label>
          <input 
            id="locationFilter"
            type="text" 
            [(ngModel)]="locationFilter" 
            (ngModelChange)="filterTablesByLocation()"
            placeholder="Enter location..." 
            class="form-control">
        </div>
      </div>

      <!-- Create Table Form -->
      <div class="create-form">
        <h3>Add New Table</h3>
        <form [formGroup]="tableForm" (ngSubmit)="createTable()">
          <div class="form-row">
            <div class="form-group">
              <label for="tableName">Table Name:</label>
              <input id="tableName" formControlName="name" type="text" class="form-control" placeholder="e.g., Garden View Table">
            </div>
            <div class="form-group">
              <label for="tableCapacity">Capacity:</label>
              <input id="tableCapacity" formControlName="capacity" type="number" class="form-control" min="1">
            </div>
            <div class="form-group">
              <label for="tableLocation">Location:</label>
              <input id="tableLocation" formControlName="location" type="text" class="form-control" placeholder="e.g., Main Dining">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="tablePrice">Price per Hour:</label>
              <input id="tablePrice" formControlName="pricePerHour" type="number" class="form-control" step="0.01">
            </div>
            <div class="form-group full-width">
              <label for="tableDescription">Description:</label>
              <textarea id="tableDescription" formControlName="description" class="form-control" rows="2"></textarea>
            </div>
          </div>
          <button type="submit" [disabled]="tableForm.invalid" class="btn btn-primary">Create Table</button>
        </form>
      </div>

      <!-- Tables List -->
      <div class="tables-grid">
        <div *ngFor="let table of filteredTables" class="table-card">
          <div class="table-header">
            <h4>{{ table.name }}</h4>
            <span [class]="table.isAvailable ? 'status-available' : 'status-unavailable'">
              {{ table.isAvailable ? 'Available' : 'Unavailable' }}
            </span>
          </div>
          <div class="table-details">
            <p><strong>Capacity:</strong> {{ table.capacity }} people</p>
            <p><strong>Location:</strong> {{ table.location }}</p>
            <p><strong>Price:</strong> ${{ table.pricePerHour }}/hour</p>
            <p *ngIf="table.description"><strong>Description:</strong> {{ table.description }}</p>
          </div>
          <div class="table-actions">
            <button (click)="toggleTableAvailability(table)" class="btn btn-sm btn-warning">
              {{ table.isAvailable ? 'Mark Unavailable' : 'Mark Available' }}
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Bookings Tab -->
    <div *ngIf="activeTab === 'bookings'" class="tab-content">
      <div class="section-header">
        <h2>Bookings</h2>
        <div class="action-buttons">
          <button (click)="showTodaysBookings()" class="btn btn-info">Today's Bookings</button>
          <button (click)="loadAllData()" class="btn btn-primary">Refresh</button>
          <button (click)="resetFilters()" class="btn btn-secondary">Reset Filters</button>
        </div>
      </div>

      <!-- Booking Filters -->
      <div class="filters-section">
        <div class="filter-group">
          <label for="statusFilter">Filter by Status:</label>
          <select id="statusFilter" [(ngModel)]="selectedStatus" (ngModelChange)="filterBookingsByStatus()" class="form-control">
            <option value="ALL">All Statuses</option>
            <option value="PENDING">Pending</option>
            <option value="CONFIRMED">Confirmed</option>
            <option value="CANCELLED">Cancelled</option>
            <option value="COMPLETED">Completed</option>
          </select>
        </div>
      </div>

      <!-- Create Booking Form -->
      <div class="create-form">
        <h3>Create New Booking</h3>
        <form [formGroup]="bookingForm" (ngSubmit)="createBooking()">
          <div class="form-row">
            <div class="form-group">
              <label for="bookingTable">Table:</label>
              <select id="bookingTable" formControlName="tableId" class="form-control">
                <option value="">Select a table...</option>
                <option *ngFor="let table of tables" [value]="table.id">
                  {{ table.name }} ({{ table.capacity }} people)
                </option>
              </select>
            </div>
            <div class="form-group">
              <label for="customerName">Customer Name:</label>
              <input id="customerName" formControlName="customerName" type="text" class="form-control">
            </div>
            <div class="form-group">
              <label for="customerEmail">Email:</label>
              <input id="customerEmail" formControlName="customerEmail" type="email" class="form-control">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="customerPhone">Phone:</label>
              <input id="customerPhone" formControlName="customerPhone" type="tel" class="form-control">
            </div>
            <div class="form-group">
              <label for="partySize">Party Size:</label>
              <input id="partySize" formControlName="partySize" type="number" class="form-control" min="1">
            </div>
            <div class="form-group">
              <label for="bookingDateTime">Date & Time:</label>
              <input id="bookingDateTime" formControlName="bookingDateTime" type="datetime-local" class="form-control">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="durationHours">Duration (hours):</label>
              <input id="durationHours" formControlName="durationHours" type="number" class="form-control" min="1">
            </div>
            <div class="form-group full-width">
              <label for="specialRequests">Special Requests:</label>
              <textarea id="specialRequests" formControlName="specialRequests" class="form-control" rows="2"></textarea>
            </div>
          </div>
          <button type="submit" [disabled]="bookingForm.invalid" class="btn btn-primary">Create Booking</button>
        </form>
      </div>

      <!-- Bookings List -->
      <div class="bookings-list">
        <div *ngFor="let booking of filteredBookings" class="booking-card">
          <div class="booking-header">
            <h4>{{ booking.customerName }}</h4>
            <span [class]="'badge ' + getStatusBadgeClass(booking.status)">{{ booking.status }}</span>
          </div>
          <div class="booking-details">
            <p><strong>Table:</strong> {{ getTableById(booking.tableId)?.name || 'Unknown' }}</p>
            <p><strong>Date & Time:</strong> {{ formatDate(booking.bookingDateTime) }}</p>
            <p><strong>Party Size:</strong> {{ booking.partySize }} people</p>
            <p><strong>Duration:</strong> {{ booking.durationHours }} hours</p>
            <p><strong>Email:</strong> {{ booking.customerEmail }}</p>
            <p *ngIf="booking.customerPhone"><strong>Phone:</strong> {{ booking.customerPhone }}</p>
            <p *ngIf="booking.specialRequests"><strong>Special Requests:</strong> {{ booking.specialRequests }}</p>
          </div>
          <div class="booking-actions">
            <button 
              *ngIf="booking.status === BookingStatus.PENDING"
              (click)="updateBookingStatus(booking, BookingStatus.CONFIRMED)" 
              class="btn btn-sm btn-success">
              Confirm
            </button>
            <button 
              *ngIf="booking.status === BookingStatus.CONFIRMED"
              (click)="updateBookingStatus(booking, BookingStatus.COMPLETED)" 
              class="btn btn-sm btn-info">
              Complete
            </button>
            <button 
              *ngIf="booking.status !== BookingStatus.CANCELLED"
              (click)="updateBookingStatus(booking, BookingStatus.CANCELLED)" 
              class="btn btn-sm btn-warning">
              Cancel
            </button>
            <button (click)="deleteBooking(booking)" class="btn btn-sm btn-danger">Delete</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Statistics Tab -->
    <div *ngIf="activeTab === 'statistics'" class="tab-content">
      <div class="section-header">
        <h2>Booking Statistics</h2>
        <button (click)="loadAllData()" class="btn btn-primary">Refresh</button>
      </div>

      <div *ngIf="bookingStatistics" class="statistics-grid">
        <div class="stat-card">
          <h3>{{ bookingStatistics.totalBookings }}</h3>
          <p>Total Bookings</p>
        </div>
        <div class="stat-card confirmed">
          <h3>{{ bookingStatistics.confirmedBookings }}</h3>
          <p>Confirmed</p>
        </div>
        <div class="stat-card pending">
          <h3>{{ bookingStatistics.pendingBookings }}</h3>
          <p>Pending</p>
        </div>
        <div class="stat-card cancelled">
          <h3>{{ bookingStatistics.cancelledBookings }}</h3>
          <p>Cancelled</p>
        </div>
        <div class="stat-card today">
          <h3>{{ bookingStatistics.todaysBookings }}</h3>
          <p>Today's Bookings</p>
        </div>
        <div class="stat-card rate">
          <h3>{{ bookingStatistics.confirmationRate.toFixed(1) }}%</h3>
          <p>Confirmation Rate</p>
        </div>
      </div>
    </div>
  </div>
</div>